<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Key Ngày Hôm Nay Là</title>
    <style>
        /* --- Facebook Style Variables --- */
        :root {
            --fb-blue: #1877f2;
            --fb-bg: #f0f2f5;
            --fb-card-bg: #ffffff;
            --fb-green: #42b72a;
            --fb-text-main: #050505;
            --fb-text-sec: #65676b;
            --fb-border: #dddfe2;
            --fb-shadow: 0 2px 4px rgba(0, 0, 0, .1), 0 8px 16px rgba(0, 0, 0, .1);
        }

        body {
            font-family: 'Segoe UI', Helvetica, Arial, sans-serif; /* Font chuẩn Facebook */
            background-color: var(--fb-bg);
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--fb-text-main);
        }

        /* Logo text style imitation */
        .fb-logo {
            color: var(--fb-blue);
            font-size: 40px;
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: -1px;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .loading-container {
            background-color: var(--fb-card-bg);
            border-radius: 8px;
            box-shadow: var(--fb-shadow);
            padding: 25px;
            width: 90%;
            max-width: 396px; /* Kích thước chuẩn khung login FB */
            text-align: center;
            box-sizing: border-box;
        }

        h1 {
            color: var(--fb-text-main);
            font-size: 20px;
            margin: 0 0 5px 0;
            font-weight: 600;
        }

        .key-label {
            font-size: 14px;
            color: var(--fb-text-sec);
            margin-bottom: 20px;
            line-height: 1.4;
        }

        /* Input styling like FB Login input */
        input[type="text"] {
            width: 100%;
            padding: 14px 16px;
            margin-bottom: 15px;
            border: 1px solid var(--fb-border);
            border-radius: 6px;
            font-size: 17px;
            color: #1d2129;
            box-sizing: border-box;
            background: #f5f6f7;
            text-align: center;
            font-weight: bold;
            transition: border-color 0.2s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: var(--fb-blue);
            box-shadow: 0 0 0 2px #e7f3ff;
            background: #fff;
        }

        .button-group {
            display: flex;
            flex-direction: column; /* Stack buttons on mobile like FB */
            gap: 12px;
        }

        /* Button styles */
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            line-height: 24px;
        }

        #copyButton {
            background-color: var(--fb-blue);
            color: #fff;
        }
        #copyButton:hover {
            background-color: #166fe5;
        }

        #musicButton {
            background-color: var(--fb-green); /* Green accent */
            color: #fff;
            font-size: 17px; /* Smaller than main action */
        }
        #musicButton:hover {
            background-color: #36a420;
        }

        /* Divider line */
        .divider {
            border-bottom: 1px solid var(--fb-border);
            margin: 20px 0;
        }

        .date-display {
            font-size: 14px;
            color: var(--fb-text-sec);
            margin-bottom: 10px;
        }

        .footer {
            font-size: 12px;
            color: #737373;
            margin-top: 20px;
        }
        
        .footer a {
            color: var(--fb-text-sec);
            font-weight: bold;
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }

        /* Ẩn player youtube */
        #player { display: none; }
    </style>
</head>
<body>

    <div class="fb-logo">facebook key</div>

    <div class="loading-container">
        <h1>Lấy Key Ngày Hôm Nay</h1>
        <div class="key-label">Hệ thống tự động tạo key hoặc lấy từ tham số</div>
        
        <div class="key-container">
            <input type="text" id="keyInput" readonly placeholder="Đang tạo key..." />
            
            <div class="button-group">
                <button id="copyButton">Sao chép Key</button>
                <div class="divider" style="margin: 5px 0; border:none;"></div>
                <button id="musicButton">▶️ Bật Nhạc</button>
            </div>
        </div>

        <div class="divider"></div>

        <div id="dateDisplay" class="date-display"></div>
        <div class="footer">
            <div style="margin-bottom:5px;">Time: <span id="clock" style="font-family:monospace;"></span></div>
            <span>Copyright © 2026</span> <br>
            Designed by <a href="https://zalo.me/0822771058">Nguyễn Duy Khánh</a>
        </div>
    </div>

    <div id="player"></div>

<script>
/* ==========================================================
   GIỮ NGUYÊN PHẦN LOGIC JAVASCRIPT CỦA BẠN
   ========================================================== */

/* ---------- Key generation + localStorage mark ---------- */
function generateRandomKey(){
    const prefix = "PHONG-TUS-";
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
    let p = "";
    for(let i=0;i<16;i++) p += chars.charAt(Math.floor(Math.random()*chars.length));
    return prefix + p;
}
function markKeyAsUsed(key){
    let used = JSON.parse(localStorage.getItem('usedKeys')||'[]');
    if(!used.includes(key)){ used.push(key); localStorage.setItem('usedKeys', JSON.stringify(used)); }
}
function isKeyUsed(key){
    let used = JSON.parse(localStorage.getItem('usedKeys')||'[]'); return used.includes(key);
}
function generateUniqueKey(){
    let attempts=0, maxAttempts=100, k;
    do{ k = generateRandomKey(); attempts++; if(attempts>maxAttempts){ localStorage.setItem('usedKeys','[]'); break; } } while(isKeyUsed(k));
    return k;
}

/* ---------- Time display ---------- */
function updateTime(){
    const now = new Date();
    const hh = String(now.getHours()).padStart(2,'0');
    const mm = String(now.getMinutes()).padStart(2,'0');
    const ss = String(now.getSeconds()).padStart(2,'0');
    const d = now.getDate(), m = now.getMonth()+1, y = now.getFullYear();
    document.getElementById('clock').textContent = `${hh}:${mm}:${ss}`;
    document.getElementById('dateDisplay').textContent = `Hôm nay là ngày ${d}/${m}/${y}`;
    document.title = `Key Ngày ${d}/${m}/${y} Là`;
    setTimeout(updateTime, 1000);
}

/* ---------- Handle URL params to fill key ---------- */
function handleQueryParams(){
    const params = new URLSearchParams(window.location.search);
    const ma = params.get('ma');
    const getkey = params.get('getkey');
    const keyInput = document.getElementById('keyInput');

    if(getkey === '1'){
        const newKey = generateUniqueKey();
        keyInput.value = newKey;
        markKeyAsUsed(newKey); // nếu bạn muốn đánh dấu ngay khi tạo
        console.log('Đã tạo key mới:', newKey);
    } else if(ma){
        keyInput.value = ma;
    } else {
        keyInput.value = generateRandomKey(); // mẫu
    }
}

/* ---------- Copy + play music on copy ---------- */
const copyBtn = document.getElementById('copyButton');
copyBtn.addEventListener('click', copyToClipboard);

async function copyToClipboard(){
    const keyInput = document.getElementById('keyInput');
    const key = keyInput.value || '';
    if(!key) return;

    // modern clipboard API
    try {
        await navigator.clipboard.writeText(key);
    } catch (e) {
        // fallback
        keyInput.select();
        document.execCommand('copy');
    }

    // feedback button text
    const originalText = copyBtn.textContent;
    copyBtn.textContent = '✅ Đã copy!';
    copyBtn.style.backgroundColor = '#42b72a'; // Feedback xanh lá tạm thời
    
    setTimeout(()=> {
        copyBtn.textContent = originalText;
        copyBtn.style.backgroundColor = ''; // Revert color
    }, 2000);

    // mark as used
    markKeyAsUsed(key);

    // start youtube music (if ready)
    if (typeof ytPlayer !== 'undefined' && ytPlayerReady) {
        try {
            ytPlayer.seekTo(0);
            ytPlayer.playVideo();
            musicButtonUpdateState(true);
        } catch(err) {
            console.warn('Không thể play youtube player:', err);
        }
    } else {
        if (!ytPlayerInitializing) {
            initYouTubePlayer(); 
        }
        playWhenReady = true;
    }
}

/* ---------- YouTube Player API integration ---------- */
let ytPlayer;
let ytPlayerReady = false;
let ytPlayerInitializing = false;
let playWhenReady = false;
const YT_VIDEO_ID = 'UKox4YEvLpg'; // ID bài hát

function initYouTubePlayer(){
    if (ytPlayerInitializing || typeof YT !== 'undefined' && ytPlayer) return;
    ytPlayerInitializing = true;
    if (!document.getElementById('yt-iframe-api')) {
        const tag = document.createElement('script');
        tag.id = 'yt-iframe-api';
        tag.src = "https://www.youtube.com/iframe_api";
        document.head.appendChild(tag);
    }
}

function onYouTubeIframeAPIReady(){
    ytPlayer = new YT.Player('player', {
        height: '0',
        width: '0',
        videoId: YT_VIDEO_ID,
        playerVars: {
            autoplay: 0,
            controls: 0,
            rel: 0,
            modestbranding: 1,
            playsinline: 1
        },
        events: {
            'onReady': function(e){
                ytPlayerReady = true;
                ytPlayerInitializing = false;
                try { ytPlayer.setVolume(60); } catch(e){}
                if (playWhenReady) {
                    ytPlayer.seekTo(0);
                    ytPlayer.playVideo();
                    playWhenReady = false;
                    musicButtonUpdateState(true);
                }
            },
            'onStateChange': function(event){
                if (event.data === 0) {
                    musicButtonUpdateState(false);
                }
            }
        }
    });
}

/* ---------- Music toggle button ---------- */
const musicBtn = document.getElementById('musicButton');
musicBtn.addEventListener('click', toggleMusic);

function toggleMusic(){
    if (typeof ytPlayer !== 'undefined' && ytPlayerReady) {
        const state = ytPlayer.getPlayerState();
        if (state === 1) {
            ytPlayer.pauseVideo(); musicButtonUpdateState(false);
        } else {
            ytPlayer.playVideo(); musicButtonUpdateState(true);
        }
    } else {
        initYouTubePlayer();
        playWhenReady = true;
        musicButtonUpdateState(true, 'Đang tải...');
    }
}

function musicButtonUpdateState(isPlaying, overrideText){
    if (overrideText) {
        musicBtn.textContent = '⏳ ' + overrideText;
        return;
    }
    musicBtn.textContent = isPlaying ? '⏸️ Tạm Dừng' : '▶️ Bật Nhạc';
}

/* ---------- Init ---------- */
window.addEventListener('load', function(){
    updateTime();
    handleQueryParams();
    initYouTubePlayer(); 
});
</script>
</body>
</html>
