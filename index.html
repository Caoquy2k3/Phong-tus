<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Key Ng√†y H√¥m Nay L√†</title>
    <style>
        :root{
            --accent:#ff4655;
            --muted:#9aa0a6;
            --bg:#0f1720;
            --card:#0b1318;
            --glass: rgba(255,255,255,0.04);
        }
        html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;background:var(--bg);color:#e6eef2;}
        /* main container (hidden when overlay active) */
        .main-wrap{
            display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px;
        }
        .card{
            width:100%;max-width:420px;padding:20px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 8px 40px rgba(0,0,0,0.6);text-align:center;
            border:1px solid rgba(255,255,255,0.03);
        }
        .card h1{font-size:22px;margin:8px 0;color:#90f2ff}
        .card input{width:85%;padding:12px;border-radius:10px;border:2px solid rgba(255,255,255,0.06);background:#071018;color:#dff6ff;font-weight:700;text-align:center}
        .btns{display:flex;gap:10px;justify-content:center;margin-top:14px;flex-wrap:wrap}
        .btn{min-width:140px;padding:12px 16px;border-radius:10px;border:none;cursor:pointer;background:var(--accent);color:#fff;font-weight:600}
        .small{font-size:13px;color:var(--muted);margin-top:12px}

        /* SITE-DOWN overlay (full screen) */
        .down-overlay{
            position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
            background:linear-gradient(180deg, rgba(2,6,11,0.92), rgba(2,6,11,0.96));
            z-index:99999;padding:24px;backdrop-filter: blur(6px);
        }
        .down-card{
            max-width:980px;width:100%;display:grid;grid-template-columns:1fr 1fr;gap:28px;align-items:center;
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:28px;border:1px solid rgba(255,255,255,0.04);
            box-shadow:0 30px 80px rgba(0,0,0,0.7);
        }
        .down-illustration{
            display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8px;
        }
        .server-icon{
            width:140px;height:140px;border-radius:16px;display:flex;align-items:center;justify-content:center;
            background:linear-gradient(135deg,#111416,#081014);border:1px solid rgba(255,255,255,0.04);
            box-shadow:0 10px 40px rgba(0,0,0,0.6), inset 0 -6px 30px rgba(255,70,90,0.02);
            position:relative;overflow:hidden;
        }
        .server-icon:after{
            content:"";position:absolute;inset:0;background:
            conic-gradient(from 200deg at 50% 30%, rgba(255,70,90,0.08), transparent 40%),
            linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
            mix-blend-mode:overlay;
        }
        .server-icon svg{width:72px;height:72px;filter:drop-shadow(0 8px 28px rgba(0,0,0,0.6));}
        .down-title{font-size:24px;font-weight:700;margin:6px 0;color:#fff}
        .down-sub{color:var(--muted);font-size:15px;max-width:420px;text-align:center}

        /* right column */
        .down-info{display:flex;flex-direction:column;gap:12px;align-items:flex-start;}
        .error-code{font-size:56px;font-weight:800;color:rgba(255,255,255,0.92);letter-spacing:2px}
        .error-msg{font-size:18px;color:#dbeef8}
        .error-note{color:var(--muted);font-size:14px}
        .down-actions{display:flex;gap:12px;margin-top:6px}
        .ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#eaf7ff;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
        .primary{background:#1a9cff;border:none;color:white;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:800}
        .retry-dot{display:inline-block;width:8px;height:8px;border-radius:50%;background:var(--accent);margin-left:8px;animation:blink 1.2s infinite}
        @keyframes blink {0%{opacity:1}50%{opacity:0.15}100%{opacity:1}}

        /* responsive */
        @media (max-width:840px){
            .down-card{grid-template-columns:1fr; text-align:center;}
            .down-info{align-items:center}
        }
    </style>
</head>
<body>
    <!-- MAIN CONTENT (KEY UI) -->
    <div class="main-wrap" id="mainContainer">
        <div class="card">
            <h1>üîë KEY C·ª¶A B·∫†N L√Ä</h1>
            <div style="color:var(--muted);font-size:13px;margin-bottom:8px;">(Hi·ªÉn th·ªã khi m·ªü t·ª´ link r√∫t g·ªçn ho·∫∑c c√≥ ?ma=...)</div>
            <input id="keyInput" readonly placeholder="‚Äî Kh√¥ng c√≥ key ‚Äî" />
            <div class="btns" style="margin-top:12px">
                <button class="btn" id="copyButton">üìã Copy Key</button>
                <button class="btn" id="musicButton">‚ñ∂Ô∏è Play Music</button>
            </div>
            <div class="small">N·∫øu kh√¥ng th·∫•y key, m·ªü b·∫±ng link g·ªëc ho·∫∑c ki·ªÉm tra l·∫°i referrer.</div>
        </div>
    </div>

    <!-- SITE DOWN OVERLAY -->
    <div class="down-overlay" id="downOverlay" style="display:none;">
        <div class="down-card" role="alert" aria-live="assertive">
            <div class="down-illustration">
                <div class="server-icon" aria-hidden="true">
                    <!-- simple server / cross SVG -->
                    <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="6" y="10" width="52" height="12" rx="2" fill="#071016"/>
                        <rect x="6" y="28" width="52" height="12" rx="2" fill="#071016"/>
                        <rect x="6" y="46" width="52" height="10" rx="2" fill="#071016"/>
                        <path d="M18 16h3M18 34h3M18 50h3" stroke="#8fbfff" stroke-width="1.6" stroke-linecap="round"/>
                        <circle cx="52" cy="16" r="2.6" fill="#ff6b6b"/>
                        <circle cx="52" cy="34" r="2.6" fill="#ffc857"/>
                        <circle cx="52" cy="50" r="2.6" fill="#6ef07a"/>
                        <!-- big X to indicate down -->
                        <g transform="translate(8,8) scale(0.9)">
                            <path d="M40 12 L52 24 M52 12 L40 24" stroke="#ff6b6b" stroke-width="3.6" stroke-linecap="round"/>
                        </g>
                    </svg>
                </div>

                <div style="margin-top:16px">
                    <div class="down-title">Trang web t·∫°m th·ªùi kh√¥ng ho·∫°t ƒë·ªông</div>
                    <div class="down-sub">Ch√∫ng t√¥i ph√°t hi·ªán trang n√†y hi·ªán ƒëang kh√¥ng ph·∫£n h·ªìi ‚Äî c√≥ th·ªÉ do hosting ho·∫∑c t√™n mi·ªÅn.</div>
                </div>
            </div>

            <div class="down-info">
                <div>
                    <div class="error-code">503</div>
                    <div class="error-msg">D·ªãch v·ª• t·∫°m th·ªùi kh√¥ng kh·∫£ d·ª•ng</div>
                    <div class="error-note" style="margin-top:8px;">
                        M√°y ch·ªß kh√¥ng ph·∫£n h·ªìi / DNS l·ªói ho·∫∑c hosting ƒë√£ t·∫°m ng·∫Øt.<br>
                        H·ªá th·ªëng ƒëang c·ªë g·∫Øng kh√¥i ph·ª•c ‚Äî th·ª≠ l·∫°i sau v√†i ph√∫t.
                    </div>
                </div>

                <div style="width:100%;display:flex;flex-direction:column;align-items:flex-start;">
                    <div class="down-actions" style="margin-top:6px;">
                        <button class="primary" id="downRetryBtn">üîÅ Th·ª≠ l·∫°i <span class="retry-dot" aria-hidden="true"></span></button>
                        <button class="ghost" id="downOpenGuideBtn">üè† Trang h∆∞·ªõng d·∫´n</button>
                    </div>

                    <div style="margin-top:14px;color:var(--muted);font-size:13px;">
                        N·∫øu b·∫°n l√† qu·∫£n tr·ªã vi√™n trang, ki·ªÉm tra:
                        <ul style="color:var(--muted);margin:8px 0 0 18px;padding:0;">
                            <li>Tr·∫°ng th√°i hosting / control panel</li>
                            <li>Thi·∫øt l·∫≠p DNS (A record / CNAME) v√† h·∫°n TTL</li>
                            <li>H√≥a ƒë∆°n thanh to√°n / renew t√™n mi·ªÅn</li>
                        </ul>
                    </div>

                    <div style="margin-top:12px;color:var(--muted);font-size:13px;">
                        Li√™n h·ªá h·ªó tr·ª£: <a href="mailto:admin@example.com" style="color:#9fe4ff;text-decoration:none">admin@example.com</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
/* ---------- Key logic (gi·ªØ nguy√™n) ---------- */
function generateRandomKey(){
    const prefix = "PHONG-TUS-";
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
    let p = "";
    for(let i=0;i<16;i++) p += chars.charAt(Math.floor(Math.random()*chars.length));
    return prefix + p;
}
function markKeyAsUsed(key){
    let used = JSON.parse(localStorage.getItem('usedKeys')||'[]');
    if(!used.includes(key)){ used.push(key); localStorage.setItem('usedKeys', JSON.stringify(used)); }
}
function isKeyUsed(key){
    let used = JSON.parse(localStorage.getItem('usedKeys')||'[]'); return used.includes(key);
}
function generateUniqueKey(){
    let attempts=0, maxAttempts=100, k;
    do{ k = generateRandomKey(); attempts++; if(attempts>maxAttempts){ localStorage.setItem('usedKeys','[]'); break; } } while(isKeyUsed(k));
    return k;
}

/* ---------- Time (optional) ---------- */
function updateTime(){
    const now = new Date();
    const d = now.getDate(), m = now.getMonth()+1, y = now.getFullYear();
    document.title = `Key Ng√†y ${d}/${m}/${y} L√†`;
}

/* ---------- Access control ---------- */
function checkAllowedAccess(){
    const params = new URLSearchParams(window.location.search);
    const ma = params.get('ma');
    const getkey = params.get('getkey');
    const ref = document.referrer || '';

    const allowedHosts = ['link4m.co','link4m.vn','link4m.com','l.link4m.co','link4m'];
    const hasAllowedRef = allowedHosts.some(h => (ref||'').includes(h));

    if (ma || getkey === '1' || hasAllowedRef) return true;
    return false;
}

/* ---------- Show / hide down overlay ---------- */
function showSiteDown(){
    document.getElementById('downOverlay').style.display = 'flex';
    document.getElementById('mainContainer').style.filter = 'blur(4px)';
    // disable main buttons
    document.getElementById('copyButton').disabled = true;
    document.getElementById('musicButton').disabled = true;
}
function hideSiteDown(){
    document.getElementById('downOverlay').style.display = 'none';
    document.getElementById('mainContainer').style.filter = 'none';
    document.getElementById('copyButton').disabled = false;
    document.getElementById('musicButton').disabled = false;
}

/* ---------- Fill key if allowed ---------- */
function handleQueryParams(){
    const params = new URLSearchParams(window.location.search);
    const ma = params.get('ma');
    const getkey = params.get('getkey');
    const keyInput = document.getElementById('keyInput');

    if(getkey === '1'){
        const newKey = generateUniqueKey();
        keyInput.value = newKey;
        markKeyAsUsed(newKey);
    } else if(ma){
        keyInput.value = ma;
    } else {
        keyInput.value = generateRandomKey();
    }
}

/* ---------- Copy button ---------- */
const copyBtn = document.getElementById('copyButton');
copyBtn.addEventListener('click', async function(){
    const key = document.getElementById('keyInput').value || '';
    if(!key) return;
    try { await navigator.clipboard.writeText(key); }
    catch(e){ document.getElementById('keyInput').select(); document.execCommand('copy'); }
    const orig = copyBtn.textContent;
    copyBtn.textContent = '‚úÖ ƒê√£ copy!';
    setTimeout(()=> copyBtn.textContent = orig, 1800);
    markKeyAsUsed(key);
});

/* ---------- Music button (kept minimal: will not auto-play) ---------- */
const musicBtn = document.getElementById('musicButton');
musicBtn.addEventListener('click', function(){
    alert('T√≠nh nƒÉng ph√°t nh·∫°c ƒë√£ gi·ªØ ƒë·ªÉ t∆∞∆°ng th√≠ch. N·∫øu mu·ªën auto-play th√¨ c·∫ßn s·ª± t∆∞∆°ng t√°c ng∆∞·ªùi d√πng tr√™n m·ªôt s·ªë tr√¨nh duy·ªát.');
});

/* ---------- Overlay buttons ---------- */
document.addEventListener('DOMContentLoaded', function(){
    updateTime();

    // ki·ªÉm tra truy c·∫≠p
    if (!checkAllowedAccess()){
        // show full site-down UI
        showSiteDown();
    } else {
        handleQueryParams();
    }

    document.getElementById('downRetryBtn').addEventListener('click', function(){
        // th·ª≠ l·∫°i: n·∫øu checkAllowedAccess pass th√¨ ·∫©n overlay, n·∫øu kh√¥ng reload ƒë·ªÉ c·∫≠p nh·∫≠t referrer
        if (checkAllowedAccess()){
            hideSiteDown();
            handleQueryParams();
        } else {
            // reload ƒë·ªÉ th·ª≠ c·∫≠p nh·∫≠t referrer ho·∫∑c sau thay ƒë·ªïi link
            location.reload();
        }
    });

    document.getElementById('downOpenGuideBtn').addEventListener('click', function(){
        window.open('https://caoquy2k3.github.io/Phong-tus/','_blank');
    });
});
</script>
</body>
</html>
