<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Key Ng√†y H√¥m Nay L√†</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f9f5f3;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .loading-container {
            text-align: center;
            padding: 20px;
            border: 2px solid #ef8682;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            background-color: #fff;
            animation: pulse 1.5s infinite;
            width: 80vw;
            max-width: 420px;
        }
        @keyframes pulse {
            0%,100% { border-color: #ef8682; }
            50% { border-color: #e9514d; }
        }
        h1 { color:#03fcec; font-size:28px; margin-bottom:20px; }
        .key-container { display:flex; flex-direction:column; align-items:center; }
        input { text-align:center; width:80%; padding:12px; margin-bottom:20px; border:2px solid:#fc0303; border-radius:8px; font-size:16px; background:#f8f8f8; font-weight:bold; }
        input:hover, input:focus { border-color:#e9514d; }
        .button-group { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
        button { background:#ef8682; color:#fff; padding:12px 24px; border:none; border-radius:8px; cursor:pointer; font-size:16px; transition:background-color .3s; min-width:140px; }
        button:hover { background:#e9514d; }
        .footer { text-align:center; margin-top:20px; color:#555; font-size:14px; }
        .admin-link { color:#ef8682; text-decoration:none; font-weight:bold; }
        .admin-link:hover { text-decoration:underline; }
        .key-label { font-size:14px; color:#888; margin-bottom:5px; }
    </style>
</head>
<body>
    <div class="loading-container">
        <h1>üîë KEY C·ª¶A B·∫†N L√Ä</h1>
        <div class="key-label">(Key t·ª± ƒë·ªông t·∫°o ho·∫∑c l·∫•y t·ª´ tham s·ªë ma)</div>
        <div class="key-container">
            <input type="text" id="keyInput" readonly>
            <div class="button-group">
                <button id="copyButton" onclick="copyToClipboard()">üìã Copy Key</button>
                <button id="musicButton" onclick="toggleMusic()">‚ñ∂Ô∏è Play Music</button>
            </div>
        </div>
        <div id="dateDisplay" style="margin-top:10px; font-size:18px; color:#555"></div>
        <div class="footer">
            <b>Copyright By 
                <a href="https://zalo.me/0822771058" class="admin-link">Nguy·ªÖn Duy Kh√°nh</a> | 
                Time: <span id="clock"></span>
            </b>
        </div>
    </div>

    <!-- YouTube player (·∫©n) -->
    <div id="yt-player-container" style="position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden;">
        <div id="ytPlayer"></div>
    </div>

    <script>
        // ---------- KEY + TIME + UTILS (gi·ªØ nguy√™n logic c·ªßa b·∫°n, ch·ªâ ƒëi·ªÅu ch·ªânh nh·∫π) ----------
        function generateRandomKey() {
            const prefix = "PHONG-TUS-";
            const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            let randomPart = "";
            for (let i = 0; i < 16; i++) {
                randomPart += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return prefix + randomPart;
        }
        function markKeyAsUsed(key) {
            let usedKeys = JSON.parse(localStorage.getItem('usedKeys') || '[]');
            if (!usedKeys.includes(key)) {
                usedKeys.push(key);
                localStorage.setItem('usedKeys', JSON.stringify(usedKeys));
            }
        }
        function isKeyUsed(key) {
            let usedKeys = JSON.parse(localStorage.getItem('usedKeys') || '[]');
            return usedKeys.includes(key);
        }
        function generateUniqueKey() {
            let maxAttempts = 100;
            let attempts = 0;
            let newKey;
            do {
                newKey = generateRandomKey();
                attempts++;
                if (attempts > maxAttempts) {
                    localStorage.setItem('usedKeys', '[]');
                    break;
                }
            } while (isKeyUsed(newKey));
            return newKey;
        }
        function updateTime() {
            var now = new Date();
            var hours = now.getHours();
            var minutes = now.getMinutes();
            var seconds = now.getSeconds();
            var day = now.getDate();
            var month = now.getMonth() + 1;
            var year = now.getFullYear();
            hours = (hours < 10 ? "0" : "") + hours;
            minutes = (minutes < 10 ? "0" : "") + minutes;
            seconds = (seconds < 10 ? "0" : "") + seconds;
            var timeString = hours + ":" + minutes + ":" + seconds;
            document.getElementById("clock").innerHTML = timeString;
            var dateString = `H√¥m nay l√† ng√†y ${day}/${month}/${year}`;
            document.getElementById("dateDisplay").innerHTML = dateString;
            document.title = `Key Ng√†y ${day}/${month}/${year} L√†`;
            setTimeout(updateTime, 1000);
        }
        function handleQueryParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const ma = urlParams.get('ma');
            const getkey = urlParams.get('getkey');
            const keyInput = document.getElementById('keyInput');
            if (getkey === '1') {
                const newKey = generateUniqueKey();
                keyInput.value = newKey;
                markKeyAsUsed(newKey);
                console.log('ƒê√£ t·∫°o key m·ªõi:', newKey);
            } else if (ma) {
                keyInput.value = ma;
            } else {
                const defaultKey = generateRandomKey();
                keyInput.value = defaultKey;
            }
        }
        function copyToClipboard() {
            const keyInput = document.getElementById('keyInput');
            keyInput.select();
            keyInput.setSelectionRange(0, 99999);
            document.execCommand('copy');
            const copyBtn = document.getElementById('copyButton');
            const originalText = copyBtn.textContent;
            copyBtn.textContent = '‚úÖ ƒê√£ copy!';
            setTimeout(() => { copyBtn.textContent = originalText; }, 2000);
        }

        window.onload = function() {
            updateTime();
            handleQueryParams();
        };

        // ---------- YOUTUBE IFRAME PLAYER SETUP ----------
        // ID video YouTube b·∫°n g·ª≠i: UKox4YEvLpg
        const YT_VIDEO_ID = 'UKox4YEvLpg';
        let ytPlayer = null;
        // Load IFrame API
        (function loadYouTubeAPI(){
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            document.head.appendChild(tag);
        })();

        // This function will be called by the YouTube API when it's ready
        function onYouTubeIframeAPIReady() {
            ytPlayer = new YT.Player('ytPlayer', {
                height: '0',
                width: '0',
                videoId: YT_VIDEO_ID,
                playerVars: {
                    'playsinline': 1,
                    'autoplay': 0,     // kh√¥ng t·ª± autoplay khi load trang (ph·∫ßn l·ªõn tr√¨nh duy·ªát ch·∫∑n)
                    'controls': 0,
                    'rel': 0,
                    'loop': 1,
                    'playlist': YT_VIDEO_ID,
                    'modestbranding': 1,
                    'iv_load_policy': 3
                },
                events: {
                    'onReady': function(event){
                        // T√πy √Ω: ƒë·∫∑t volume m·∫∑c ƒë·ªãnh (0-100)
                        try { event.target.setVolume(60); } catch(e){}
                    },
                    'onStateChange': function(e){
                        // c√≥ th·ªÉ x·ª≠ l√Ω tr·∫°ng th√°i n·∫øu c·∫ßn
                    }
                }
            });
        }

        // Toggle play/pause b·∫±ng YouTube player
        function toggleMusic() {
            const musicButton = document.getElementById('musicButton');
            if (!ytPlayer || typeof ytPlayer.getPlayerState !== 'function') {
                // n·∫øu player ch∆∞a s·∫µn s√†ng, b√°o cho user
                musicButton.textContent = '‚åõ ƒêang t·∫£i...';
                setTimeout(() => { musicButton.textContent = '‚ñ∂Ô∏è Play Music'; }, 1500);
                return;
            }
            const state = ytPlayer.getPlayerState();
            // YT states: -1 (unstarted), 0 ended, 1 playing, 2 paused
            if (state === YT.PlayerState.PLAYING) {
                ytPlayer.pauseVideo();
                musicButton.textContent = '‚ñ∂Ô∏è Play Music';
            } else {
                // playVideo s·∫Ω ƒë∆∞·ª£c coi l√† user gesture v√¨ b·∫•m n√∫t
                ytPlayer.playVideo();
                musicButton.textContent = '‚è∏Ô∏è Pause Music';
            }
        }
    </script>
</body>
</html>
